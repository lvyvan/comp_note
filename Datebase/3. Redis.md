# 1. Redis基础

## 1.1 基础篇

### 1.1.1 Redis是什么

Redis: Remote Dictionary Server(远程字典服务器)

Redis is an open source (BSD licensed), in-memory data structure store used as a database, cache, message broker, and streaming engine. Redis provides data structures such as strings, hashes, lists, sets, sorted sets with range queries, bitmaps, hyperloglogs, geospatial indexes, and streams. Redis has built-in replication, Lua scripting, LRU eviction, transactions, and different levels of on-disk persistence, and provides high availability via Redis Sentinel and automatic partitioning with Redis Cluster.

Github [antirez (Salvatore Sanfilippo) · GitHub](https://github.com/antirez)

BBS [antirez.com](http://antirez.com/latest/0)

### 1.1.2 Redis能做什么？

基于内存的 KV 键值对数据库

主要功能与应用
1. 分布式缓存
2. 内存存储和持久化（ RDB + AOF )
3. 高可用架构搭配
4. 缓存穿透、击穿、雪崩
5. 分布式锁
6. 队列
...

### 1.1.3 Redis安装

#### 1. 下载Redis
https://download.redis.io/redis-stable.tar.gz

#### 2. Redis 解压目录

![[Redis_Unzip.png|800]]

#### 3. Redis 安装步骤

	$ make && make install
	...
	Hint: It's a good idea to run 'make test' ;)
	
	make[1]: Leaving directory '/opt/redis-7.0.9/src'
	cd src && make install
	make[1]: Entering directory '/opt/redis-7.0.9/src'
	    CC Makefile.dep
	
	Hint: It's a good idea to run 'make test' ;)
	
	    INSTALL redis-server
	    INSTALL redis-benchmark
	    INSTALL redis-cli
	make[1]: Leaving directory '/opt/redis-7.0.9/src'
	$ cd /usr/local/bin/
	$ ll
	redis-benchmark                    性能测试工具，服务启动后运行该命令
	redis-check-aof -> redis-server    修复有问题的AOF文件
	redis-check-rdb -> redis-server    修复有问题的dump.rdb文件
	redis-cli                          客户端
	redis-sentinel -> redis-server     redis集群使用
	redis-server                       redis服务器启动命令

#### 4. 配置 Redis
	$ cp /opt/redis-7.0.9/redis.conf .
	$ vim redis.conf
	daemonize no -> yes (前台切换为后台)
	protected-mode yes -> no (安全模式)
	# bind 127.0.0.1 -::1 (注释掉)
	# requirepass foobared -> requirepass redis

#### 5. 启动 Redis 服务
	$ redis-server conf/redis.conf
	$ ps -ef|grep redis|grep -v grep
	root       15413       1  0 22:48 ?        00:00:00 redis-server *:6379

#### 6. Redis 连接
	$ redis-cli -a redis -p 6379
	127.0.0.1:6379> ping
	PONG
	127.0.0.1:6379> quit
	$ redis-cli
	127.0.0.1:6379> auth redis
	OK
	127.0.0.1:6379> ping
	PONG
	127.0.0.1:6379> quit

#### 7. 永远的 Hello World!

	127.0.0.1:6379> set k1 HelloWorld!
	OK
	127.0.0.1:6379> get k1
	"HelloWorld!"

#### 8. 关闭 Redis

连接内部关闭

	127.0.0.1:6379> SHUTDOWN
	not connected> 

单实例关闭

	redis-cli -a redis shutdown

多实例关闭

	redis-cli -p 6379 shutdown

	$ lsof -i:6379

### 1.1.4 Redis 数据类型

#### 1. String

二进制安全类型，String可以包含任何数据，比如jpg图片或序列号的对象。

String类型是Redis最基本的数据类型，一个Redis中字符串value最多是512M。

#### 2. List

简单字符串列表，按照插入顺序排序。可以添加一个元素到列表的头部或尾部。

底层实现是双端链表，最多包含 2^32-1 个元素

#### 3. Hash

String类型的 field（字段）和 value（值）的映射表，hash特别适合用于存储对象。

每个 hash 可以存储 2^32-1 个元素

#### 4. Set

String类型的无序集合。集合成员是唯一的，这就意味着集合重不能出现重复的数据，
集合对象的编码可以是 intset 或者 hashtable。

Redis 中 Set 集合是通过哈希表实现的，所以添加、删除、查找的复杂度都是 O(1)。

#### 5. ZSet

String类型元素的集合，且不允许重复的成员。

每个元素都会关联一个 double 类型的分数，redis正是通过分数来为集合中的成员进行
从小到大的排序。

ZSet的成员是唯一的，但分数(score)却可以重复。

ZSet集合是通过哈希实现的，所以添加、删除、查找的复杂度都是O(1)。

#### 6. GEO

Redis GEO 主要用于存储地理位置，并对存储的信息进行操作，包括

1. 添加地理位置的坐标。
2. 获取地理位置的坐标。
3. 计算两个位置之间的距离。
4. 根据用户给定的经纬度坐标来获取指定范围内的地理位置集合。

#### 7. HyperLogLog

基数统计的算法，HyperLogLog的优点是，在输入元素的数量或者体积 > > 大时，
计算基数所需要的空间总是固定且是很小的。

在Redis里面，每个 HyperLogLog 键只需要花费 12KB 内存，就可以计算接近 2^64 个
不同元素的基数，这和计算基数时，元素越多耗费内存就越多的集合形成鲜明对比。

因为 HyperLogLog 只会根据输入元素来计算基数，而不会存储输入元素本身，所以 HyperLogLog
不能像集合那样，返回输入的各个元素。

#### 8. BitMap

由 0 和 1 状态表现的二进制的 Bit 数组。

#### 9. BitField

通过 bitfield 命令一次性操作多个位域（指的是连续的多个比特位），它会执行一系列操作并
返回一个响应数组，这个数组中的元素对应参数列表中的相应操作的执行结果。

通过 bitfield 命令我们可以一次性对多个比特位域进行操作。

#### 10. Stream

Redis Stream 主要用于消息队列（MQ），Redis 本身是一个 Redis 发布订阅（pub/sub）来
实现消息队列的功能，但它有个缺点就是消息无法持久化，如果出现网络断开、Redis宕机等，
消息就会被丢弃。

发布订阅（pub/sub）可以分发消息，但无法记录历史消息。

而 Redis Stream 提供了消息的持久化和主备复制功能，可以让任何客户端访问任何时刻的数据，
并且能记住每一个客户端的访问位置，还能保证消息不丢失。

### 1.1.5 常用命令

1. keys * 查看当前库所以的 key
2. exists key 判断某个 key 是否存在
3. type key 查看 key 的类型
4. del key 删除指定的 key 数据
5. unlink key 非阻塞删除，仅仅将 keys 从 keyspace 元数据中删除，正式删除会在后续异步删除
6. ttl key 查看还有多少秒过期， -1 表示永不过期，-2 表示已过期
7. expire key 秒钟 为给定的 key 设置过期时间
8. move key dbindex{0 - 15}  将当前数据库的 key 移动到给定的数据库 db 当中
9. select dbindex 切换数据库{0 - 15}，默认为0
10. dbsize 查看当前数据库 key 的数量
11. flushdb 清空当前库
12. flushall 通杀全部库

注意：

1. 命令是不区分大小写的，而 key 是区分大小写的
2. hlep @{type}

### 1.1.6 String 命令详解




## 1.2 高级篇

# 2. Redis进阶

## 2.1 Redis面试题

## 2.2 生产需求案例

## 2.3 Redis新特性